<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Promillerechner mit Diagramm</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: sans-serif;
      color: darkblue; /* Alle Texte dunkelblau */
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }
    .form-group {
      margin-bottom: 15px;
    }
    label {
      display: block;
      margin-bottom: 5px;
    }
    input[type="number"], select {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }
    .input-group {
      display: flex;
      align-items: center;
    }
    .unit {
      margin-left: 10px;
    }
    button {
      background-color: #4CAF50;
      color: white;
      padding: 12px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .tooltip {
      position: relative;
      display: inline-block;
    }
    .tooltip .tooltiptext {
      visibility: hidden;
      width: 120px;
      background-color: #555;
      color: #fff;
      text-align: center;
      border-radius: 6px;
      padding: 5px 0;
      position: absolute;
      z-index: 1;
      bottom: 125%;
      left: 50%;
      margin-left: -60px;
      opacity: 0;
      transition: opacity 0.3s;
    }
    .tooltip .tooltiptext::after {
      content: "";
      position: absolute;
      top: 100%;
      left: 50%;
      margin-left: -5px;
      border-width: 5px;
      border-style: solid;
      border-color: #555 transparent transparent transparent;
    }
    .tooltip:hover .tooltiptext {
      visibility: visible;
      opacity: 1;
    }
    #result {
      margin-top: 20px;
    }
    #chartContainer {
      margin-top: 20px;
      background-color: lightblue; /* Hellblauer Hintergrund für das Diagramm */
    }
    h1 { /* Titel dunkelblau */
      color: darkblue;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Promillerechner mit Diagramm</h1>
    <form id="alcoholForm">
      <div class="form-group">
        <label for="weight" class="tooltip">Gewicht
          <span class="tooltiptext">Geben Sie Ihr Körpergewicht in Kilogramm ein.</span>
        </label>
        <div class="input-group">
          <input type="number" id="weight" required min="30" max="200">
          <span class="unit">kg</span>
        </div>
      </div>
      <div class="form-group">
        <label for="height" class="tooltip">Größe
          <span class="tooltiptext">Geben Sie Ihre Körpergröße in Zentimetern ein.</span>
        </label>
        <div class="input-group">
          <input type="number" id="height" required min="100" max="250">
          <span class="unit">cm</span>
        </div>
      </div>
      <div class="form-group">
        <label for="gender" class="tooltip">Geschlecht
          <span class="tooltiptext">Wählen Sie Ihr biologisches Geschlecht aus.</span>
        </label>
        <select id="gender" required>
          <option value="male">Männlich</option>
          <option value="female">Weiblich</option>
        </select>
      </div>
      <div class="form-group">
        <label for="consumptionTime" class="tooltip">Dauer des Konsums
          <span class="tooltiptext">Geben Sie die Dauer des Alkoholkonsums in Stunden ein.</span>
        </label>
        <div class="input-group">
          <input type="number" id="consumptionTime" required min="0" step="1">
          <span class="unit">Stunden</span>
        </div>
      </div>
      <div class="form-group">
        <label for="beerVolume" class="tooltip">Bier
          <span class="tooltiptext">Geben Sie die Menge des konsumierten Biers in Litern an.</span>
        </label>
        <div class="input-group">
          <input type="number" id="beerVolume" min="0" step="0.1">
          <span class="unit">Liter</span>
        </div>
      </div>
      <div class="form-group">
        <label for="wineVolume" class="tooltip">Wein
          <span class="tooltiptext">Geben Sie die Menge des konsumierten Weins in Litern an.</span>
        </label>
        <div class="input-group">
          <input type="number" id="wineVolume" min="0" step="0.1">
          <span class="unit">Liter</span>
        </div>
      </div>
      <div class="form-group">
        <label for="spiritsVolume" class="tooltip">Spirituosen
          <span class="tooltiptext">Geben Sie die Menge der konsumierten Spirituosen an und wählen Sie die Einheit.</span>
        </label>
        <div class="input-group">
          <input type="number" id="spiritsVolume" min="0" step="0.001">
          <select id="spiritsUnit">
            <option value="l">Liter</option>
            <option value="cl">Centiliter</option>
            <option value="ml">Milliliter</option>
          </select>
        </div>
      </div>
      <button type="submit">Berechnen</button>
    </form>

    <div id="result"></div>
    <div id="chartContainer">
      <canvas id="bakChart"></canvas>
    </div>
  </div>

  <script>
    let bakChart;
    document.getElementById('alcoholForm').addEventListener('submit', function(e) {
      e.preventDefault();

      const weight = parseFloat(document.getElementById('weight').value);
      const height = parseFloat(document.getElementById('height').value);
      const gender = document.getElementById('gender').value;
      const consumptionTime = parseFloat(document.getElementById('consumptionTime').value);
      const beerVolume = parseFloat(document.getElementById('beerVolume').value) || 0;
      const wineVolume = parseFloat(document.getElementById('wineVolume').value) || 0;
      const spiritsVolume = parseFloat(document.getElementById('spiritsVolume').value) || 0;
      const spiritsUnit = document.getElementById('spiritsUnit').value;

      // Überprüfen, ob mindestens eine Alkoholart eingegeben wurde
      if (beerVolume === 0 && wineVolume === 0 && spiritsVolume === 0) {
        alert("Bitte geben Sie mindestens eine Alkoholart ein.");
        return;
      }

      // Alkoholgehalt in g/100ml
      const beerAlcohol = 5;
      const wineAlcohol = 12;
      const spiritsAlcohol = 40;

      // Konvertiere Spirituosenmenge in Liter
      let spiritsLiters;
      switch (spiritsUnit) {
        case 'l':
          spiritsLiters = spiritsVolume;
          break;
        case 'cl':
          spiritsLiters = spiritsVolume / 100;
          break;
        case 'ml':
          spiritsLiters = spiritsVolume / 1000;
          break;
      }

      // Berechnung der Alkoholmenge in Gramm
      const alcoholGrams = (beerVolume * 1000 * beerAlcohol / 100 * 0.8) +
        (wineVolume * 1000 * wineAlcohol / 100 * 0.8) +
        (spiritsLiters * 1000 * spiritsAlcohol / 100 * 0.8);

      // Berechnung des Reduktionsfaktors nach Seidl et al.
      let r;
      if (gender === 'male') {
        r = 0.31608 - 0.004821 * weight + 0.004432 * height;
      } else {
        r = 0.31223 - 0.006446 * weight + 0.004466 * height;
      }

      // Berechnung des BAK-Verlaufs
      const bakData = [];
      const timeLabels = [];
      let currentBak = 0; // Startwert bei 0 Promille
      let hour = 0;

      // Berechnung der BAK für jeden Zeitpunkt
      while (hour <= 12) { // Schleife läuft für 12 Stunden
        let tempBak = alcoholGrams / (weight * r) - (hour * 0.15); // BAK direkt berechnen
        currentBak = Math.max(0, tempBak); // BAK darf nicht negativ werden
        bakData.push(currentBak);
        timeLabels.push(hour);
        hour += 0.5;
      }

      // Ermittle den Zeitpunkt und den Wert der maximalen BAK aus dem BAK-Verlauf
      let maxBak = Math.max(...bakData);
      let maxBakTime = timeLabels[bakData.indexOf(maxBak)];

      const resultDiv = document.getElementById('result');
      resultDiv.innerHTML = `
        <h2>Ergebnis:</h2>
        <p>Nach ${maxBakTime.toFixed(1)} Stunden beträgt Ihre Blutalkoholkonzentration: ${maxBak.toFixed(2)} ‰</p>
        <p>Ihr Blutalkoholspiegelverlauf:</p>
        <p><strong>Wichtiger Hinweis:</strong> Diese Berechnung dient nur zur Orientierung und ersetzt keine medizinische oder rechtliche Beurteilung.
        Die tatsächliche Blutalkoholkonzentration kann individuell abweichen.</p>
      `;

      // Erstellen oder Aktualisieren des Diagramms
      if (bakChart) {
        bakChart.destroy();
      }

      const ctx = document.getElementById('bakChart').getContext('2d');
      bakChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: timeLabels,
          datasets: [{
            label: 'Blutalkoholkonzentration (‰)',
            data: bakData,
            borderColor: 'rgb(75, 192, 192)',
            tension: 0.1
          }]
        },
        options: {
          responsive: true,
          scales: {
            x: {
              title: {
                display: true,
                text: 'Zeit (Stunden)'
              }
            },
            y: {
              title: {
                display: true,
                text: 'BAK (‰)'
              },
              min: 0
            }
          }
        }
      });
    });
  </script>
</body>
</html>
